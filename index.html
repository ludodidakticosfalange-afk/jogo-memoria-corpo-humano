<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jogo da Mem√≥ria Educativo ‚Äî Mem√≥ria do Sim√£o ‚Äì Corpo Humano</title>
  <style>
    :root {
      --bg-overlay: rgba(15, 23, 42, 0.85);
      --txt: #f8fafc;
      --accent: #22c55e;
      --gold: #d4af37;
      --radius: 16px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(var(--bg-overlay), var(--bg-overlay)),
                  url('fundo.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color: var(--txt);
      display: flex; flex-direction: column; align-items: center;
      padding: 20px; min-height: 100vh;
    }

    /* Screens */
    #menuScreen, #gameScreen, #certScreen {
      display: flex; flex-direction: column; align-items: center;
      width: 100%; max-width: 800px;
      min-height: 100vh;
    }
    #gameScreen, #certScreen { display: none; }

    h1 { font-size: 32px; margin: 10px 0; color: #60a5fa; text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }

    /* Registration Box */
    .registration-box {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      padding: 25px; border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      width: 100%; max-width: 450px;
      margin-bottom: 20px; border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .input-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px; }
    .input-group label { font-weight: bold; color: #93c5fd; font-size: 14px; }
    .input-group input {
      padding: 14px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.05); color: white; font-size: 16px; outline: none;
    }

    /* Menu Cards */
    .menu-grid {
      display: grid; gap: 15px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      width: 100%; pointer-events: none; opacity: 0.5; transition: 0.4s ease;
    }
    .menu-grid.active { pointer-events: auto; opacity: 1; }

    .phase-card {
      background: rgba(15, 23, 42, 0.7); border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px; padding: 20px; cursor: pointer; transition: 0.3s; text-align: center;
    }
    .phase-card:hover { transform: translateY(-5px); border-color: #3b82f6; background: rgba(59, 130, 246, 0.2); }

    .fase-ancora{
      font-size: 0.9rem;
      color: #e0e0e0;
      opacity: 0.85;
      max-width: 900px;
      margin: 6px auto 14px;
      text-align: center;
      line-height: 1.4;
    }

    /* Game UI */
    .grid {
      display: grid; gap: 12px; grid-template-columns: repeat(4, 1fr);
      width: 100%; max-width: 650px;
    }

    .card { aspect-ratio: 1 / 1; perspective: 1000px; cursor: pointer; }
    .inner {
      position: relative; width: 100%; height: 100%;
      transition: transform 0.6s; transform-style: preserve-3d; border-radius: var(--radius);
    }
    .card.flipped .inner { transform: rotateY(180deg); }
    .face {
      position: absolute; width: 100%; height: 100%;
      backface-visibility: hidden; border-radius: var(--radius);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      border: 2px solid rgba(255,255,255,0.1);
    }

    .back {
      background-image: url('capa-carta-corpo.png');
      background-size: cover;
      background-position: center calc(56% + 40px);
    }

    .front { background: #ffffff; transform: rotateY(180deg); color: #1e293b; }

    .card-photo{
      width: 78%;
      height: auto;
      max-height: 70%;
      object-fit: contain;
      display: block;
    }
    .card-label { font-size: 10px; font-weight: 900; margin-top: 5px; text-transform: uppercase; color: #1e40af; }
    .card.matched .inner .front { border: 4px solid var(--accent); background: #f0fdf4; }

    /* Sound Control */
    .sound-toggle {
      background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255,255,255,0.2);
      color: white; padding: 8px 15px; border-radius: 50px; cursor: pointer;
      display: flex; align-items: center; gap: 8px; font-weight: bold;
    }

    /* Modals */
    .modal {
      position: fixed; inset: 0; background: rgba(0,0,0,0.85);
      display: none; align-items: center; justify-content: center; z-index: 100; padding: 20px;
    }
    .modal.show { display: flex; }
    .modal-content {
      background: #1e293b; padding: 30px; border-radius: 24px; text-align: center;
      max-width: 450px; width: 100%; border: 1px solid rgba(255,255,255,0.1);
    }

    .btn {
      padding: 12px 24px; font-size: 16px; font-weight: bold; border: none; border-radius: 12px;
      background: #3b82f6; color: white; cursor: pointer; transition: 0.2s; width: 100%; margin-top: 10px;
    }
    .btn-gold { background: var(--gold); color: #000; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4); }
    .btn-outline { background: transparent; border: 2px solid #3b82f6; }

    /* Certificate */
    .certificate-container {
      background: white; color: #1a1a1a; width: 100%; padding: 40px;
      border: 12px solid #1e3a8a; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
      margin: 20px 0; border-style: double;
    }
    .cert-title { font-size: 36px; color: #1e3a8a; font-weight: bold; margin-bottom: 10px; }
    .cert-name { font-size: 32px; font-weight: bold; color: #1e40af; border-bottom: 2px solid #cbd5e1; display: inline-block; min-width: 250px; margin: 20px 0; }

    /* ===== AJUSTES PARA CELULAR E TABLET ===== */
    @media (max-width: 768px) {
      body { padding: 8px; }
      .grid { gap: 8px; }
      .card-label { font-size: 9px; }
      .back { background-size: contain; background-position: center center; background-color: #0f172a; }
    }

    .phase-icon-img {
      width: 64px;
      height: auto;
      object-fit: contain;
      margin-bottom: 10px;
      filter: drop-shadow(0 0 8px rgba(255, 255, 200, 0.9));
      animation: brilhoSuave 2s infinite alternate;
      background: radial-gradient(circle, rgba(255,255,255,0.35) 60%, rgba(255,255,255,0) 70%);
      padding: 6px;
      border-radius: 50%;
    }

    @keyframes brilhoSuave {
      from { filter: drop-shadow(0 0 6px rgba(255, 255, 200, 0.6)); }
      to   { filter: drop-shadow(0 0 14px rgba(255, 255, 200, 1)); }
    }

    /* =========================
       PRINT AREA (CARTAS)
       ========================= */
    #printArea{ display:none; background:#fff; color:#000; }

    /* =========================
       PRINT MODES (CARTAS vs CERTIFICADO)
       ========================= */
    @media print {
      body * { visibility: hidden !important; }

      /* --- MODO: CARTAS --- */
      body.print-mode-cards #printArea,
      body.print-mode-cards #printArea * {
        visibility: visible !important;
      }
      body.print-mode-cards #printArea{
        position:absolute;
        left:0; top:0;
        width:100%;
        display:block !important;
      }

      /* --- MODO: CERTIFICADO --- */
      body.print-mode-cert #certScreen,
      body.print-mode-cert #certScreen *{
        visibility: visible !important;
      }
      body.print-mode-cert #certScreen{
        position:absolute;
        left:0; top:0;
        width:100%;
        display:flex !important;
        padding:0 !important;
        margin:0 !important;
      }

      /* folha */
      @page { size: A4; margin: 10mm; }

      html, body{
        margin:0 !important;
        padding:0 !important;
        background:#fff !important;
      }

      /* ===== CARTAS (A4) ===== */
      .sheet { page-break-after: always; width:210mm; min-height:297mm; padding:10mm; box-sizing:border-box; background:#fff; }
      .sheet:last-child { page-break-after: auto; }
      .print-title{ font: 900 14pt/1.2 "Segoe UI", system-ui, sans-serif; margin: 0 0 8mm 0; color:#0f172a; }

      .print-grid{ display:grid; grid-template-columns: repeat(4, 1fr); gap: 6mm; }

      .print-card{
        border: 2px solid #1e40af;
        border-radius: 12px;
        overflow: hidden;
        aspect-ratio: 1 / 1;
        display:flex;
        align-items:center;
        justify-content:center;
        box-sizing:border-box;
        background:#fff;
        break-inside: avoid;
        page-break-inside: avoid;
      }

      .print-card-front{
        width:100%;
        height:100%;
        display:flex;
        flex-direction:column;
        align-items:center;
        justify-content:center;
      }

      .print-card img{
        width: 86%;
        height: auto;
        max-height: 78%;
        object-fit: contain;
      }

      .print-card .lbl{
        font: 900 10pt/1.1 "Segoe UI", system-ui, sans-serif;
        text-transform: uppercase;
        color:#1e40af;
        margin-top: 3mm;
        text-align:center;
        padding: 0 2mm;
      }

      .print-back{
        background:#0f172a;
        display:flex;
        align-items:center;
        justify-content:center;
      }
      .print-back img{
        width: 100%;
        height: 100%;
        object-fit: contain;
        display:block;
      }

      /* ===== CERTIFICADO (A4) ===== */
      body.print-mode-cert .certificate-container{
        width: 190mm !important;            /* 210 - 2*10mm margens */
        min-height: 277mm !important;       /* 297 - 2*10mm margens */
        margin: 0 auto !important;
        box-shadow: none !important;
      }
      body.print-mode-cert .no-print{ display:none !important; }
    }
  </style>
</head>

<body>

  <!-- MENU -->
  <div id="menuScreen">
    <h1>Mem√≥ria do Sim√£o ‚Äì Corpo Humano</h1>

    <div class="registration-box">
      <div class="input-group">
        <label>Nome do Aluno:</label>
        <input type="text" id="userName" placeholder="Escreva seu nome..." oninput="validateRegistration()">
      </div>
      <div class="input-group">
        <label>Turma:</label>
        <input type="text" id="userClass" placeholder="Ex: 5¬∫ A" oninput="validateRegistration()">
      </div>
      <p id="regHint" style="font-size: 13px; color: #fb7185; text-align: center;">
        Preenche os dados para desbloquear as miss√µes.
      </p>

      <button class="btn btn-gold" type="button" onclick="exportPDF_All()">
        üìÑ Exportar cartas em PDF (para recortar)
      </button>
    </div>

    <div class="menu-grid" id="menuGrid">
      <div class="phase-card" onclick="startGame(0)">
        <img src="simao-fase1.png" class="phase-icon-img" alt="Sim√£o Fase 1">
        <h3>Fase 1</h3>
        <h2>Fase 1 ‚Äì √ìrg√£os Vitais para o Funcionamento do Corpo no Dia a Dia</h2>
        <p class="fase-ancora">
          Nesta atividade, s√£o considerados √≥rg√£os vitais aqueles que ajudam o corpo humano a funcionar no dia a dia,
          de forma acess√≠vel e significativa para estudantes da educa√ß√£o especial.
        </p>
      </div>

      <div class="phase-card" onclick="startGame(1)">
        <img src="simao-fase2.png" class="phase-icon-img" alt="Sim√£o Fase 2">
        <h3>Fase 2</h3>
        <h2>Fase 2 ‚Äì Sentidos e Partes do Corpo</h2>
        <p class="fase-ancora">
          Nesta atividade, os conte√∫dos abordam os sentidos humanos e partes do corpo relacionadas √†s fun√ß√µes do dia a dia,
          de forma acess√≠vel e significativa para estudantes da educa√ß√£o especial.
        </p>
      </div>

      <div class="phase-card" onclick="startGame(2)">
        <img src="simao-fase3.png" class="phase-icon-img" alt="Sim√£o Fase 3">
        <h3>Fase 3</h3>
        <h2>Fase 3 ‚Äì Estruturas de Apoio e Movimento</h2>
        <p class="fase-ancora">
          Nesta atividade, exploramos estruturas que ajudam o corpo a ficar firme, mover-se e proteger √≥rg√£os importantes,
          de forma acess√≠vel e significativa para estudantes da educa√ß√£o especial.
        </p>
      </div>
    </div>
  </div>

  <!-- GAME -->
  <div id="gameScreen">
    <div style="display: flex; justify-content: space-between; width: 100%; max-width: 650px; margin-bottom: 15px; align-items: center;">
      <button class="btn btn-outline" style="width: auto; margin:0;" onclick="location.reload()">‚¨ÖÔ∏è Sair</button>
      <button id="soundToggleBtn" class="sound-toggle" onclick="toggleSound()">
        <span id="soundIcon">üîä</span> Som: Ligado
      </button>
      <div style="background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 50px;">
        Pares: <span id="pairCount">0</span> / 8
      </div>
    </div>

    <h2 id="currentLevelTitle" style="margin-bottom: 20px;">Fase 1</h2>
    <div class="grid" id="grid"></div>
  </div>

  <!-- CERTIFICATE -->
  <div id="certScreen">
    <div class="certificate-container" id="printableArea">
      <div style="border: 2px solid #d4af37; padding: 30px;">
        <div class="cert-title">CERTIFICADO DE CONCLUS√ÉO</div>

        <p style="text-transform: uppercase; letter-spacing: 2px; color: #64748b;">Ci√™ncias Naturais</p>
        <p style="font-size: 20px; margin-top: 30px;">Certificamos que o(a) aluno(a):</p>
        <div class="cert-name" id="certName">NOME DO ALUNO</div>

        <p style="font-size: 18px;">
          Concluiu com √™xito a <b>Mem√≥ria do Sim√£o ‚Äì Corpo Humano</b>,<br>
          demonstrando conhecimentos sobre o corpo humano.
        </p>

        <div style="margin-top: 40px; display: flex; justify-content: space-between; align-items: center;">
          <span id="certDate">00/00/0000</span>
          <span style="font-size: 60px;">üèÜ</span>
          <div style="border-top: 1px solid #000; width: 150px; font-size: 12px;">Professor(a)</div>
        </div>
      </div>
    </div>

    <div class="no-print" style="display: flex; gap: 10px; width: 100%; max-width: 400px;">
      <button class="btn" style="background: #22c55e;" onclick="printCertificate()">üñ®Ô∏è Imprimir Certificado</button>
      <button class="btn btn-outline" onclick="location.reload()">Voltar ao In√≠cio</button>
    </div>
  </div>

  <!-- MODALS -->
  <div class="modal" id="infoModal">
    <div class="modal-content">
      <img id="infoImage" src="" alt="" style="width: 120px; max-height: 120px; object-fit: contain; margin-bottom: 15px;">
      <h2 id="infoTitle" style="color: #60a5fa;"></h2>
      <p id="infoText" style="font-size: 18px; line-height: 1.6; margin: 20px 0;"></p>
      <button class="btn" onclick="closeInfo()">Continuar Miss√£o</button>
    </div>
  </div>

  <div class="modal" id="winModal">
    <div class="modal-content">
      <div style="font-size: 60px;">üéâ</div>
      <h2 id="winHeading">Fase Conclu√≠da!</h2>
      <p id="winMessage" style="margin-bottom: 20px;"></p>
      <button id="nextPhaseBtn" class="btn" onclick="nextPhase()">Ir para a Pr√≥xima Fase ‚û°Ô∏è</button>
      <button id="getCertBtn" class="btn btn-gold" style="display:none;" onclick="showFinalCertificate()">üéì Obter Meu Certificado</button>
      <button class="btn btn-outline" onclick="location.reload()">Menu Inicial</button>
    </div>
  </div>

  <!-- √ÅREA OCULTA PARA EXPORTA√á√ÉO EM PDF -->
  <div id="printArea"></div>

  <script>
    const LEVELS = [
      { title: "Fase 1: √ìrg√£os Vitais para o Funcionamento do Corpo no Dia a Dia", data: [
          { id: 1, label: "C√©rebro", img: "cerebro.png", info: "O c√©rebro √© o mestre do corpo! Ele processa informa√ß√£o e envia ordens para todos os √≥rg√£os." },
          { id: 2, label: "Cora√ß√£o", img: "coracao.png", info: "O cora√ß√£o √© um m√∫sculo forte que bombeia sangue rico em oxig√™nio para todo o corpo." },
          { id: 3, label: "Pulm√µes", img: "pulmoes.png", info: "Os pulm√µes nos permitem respirar, trocando o oxig√™nio pelo g√°s carb√¥nico." },
          { id: 4, label: "Est√¥mago", img: "estomago.png", info: "No est√¥mago, os alimentos s√£o misturados com sucos g√°stricos para come√ßar a digest√£o." },
          { id: 5, label: "F√≠gado", img: "figado.png", info: "O f√≠gado ajuda a limpar o sangue e armazena energia para quando precisamos." },
          { id: 6, label: "Rins", img: "rins.png", info: "Os rins funcionam como filtros que removem as impurezas do nosso sangue." },
          { id: 7, label: "Intestinos", img: "intestinos.png", info: "Os intestinos absorvem os nutrientes da comida que o corpo utiliza para crescer." },
          { id: 8, label: "Bexiga", img: "bexiga.png", info: "A bexiga armazena a urina at√© que o corpo esteja pronto para eliminar." }
      ]},
      { title: "Fase 2: Sentidos e Partes do Corpo", data: [
          { id: 9,  label: "Olhos", img: "olhos.png", info: "A vis√£o nos permite ver cores, formas e a dist√¢ncia das coisas ao nosso redor." },
          { id: 10, label: "Ouvidos", img: "ouvidos.png", info: "O ouvido capta vibra√ß√µes do ar para que possamos ouvir sons e m√∫sica." },
          { id: 11, label: "Nariz", img: "nariz.png", info: "O olfato nos ajuda a sentir cheiros e tamb√©m √© muito importante para o paladar." },
          { id: 12, label: "L√≠ngua", img: "lingua.png", info: "A l√≠ngua tem papilas gustativas que identificam os sabores: doce, salgado, azedo e amargo." },
          { id: 13, label: "Pele", img: "pele.png", info: "A pele √© o maior √≥rg√£o do corpo e nos permite sentir o toque, o calor e o frio." },
          { id: 14, label: "Dentes", img: "dentes.png", info: "Os dentes cortam e trituram os alimentos para facilitar o trabalho do est√¥mago." },
          { id: 15, label: "Sangue", img: "sangue.png", info: "O sangue viaja por todo o corpo transportando oxig√™nio e nutrientes." },
          { id: 16, label: "Art√©rias", img: "arterias.png", info: "As art√©rias s√£o os 'tubos' que levam o sangue do cora√ß√£o para o resto do corpo." }
      ]},
      { title: "Fase 3: Estruturas de Apoio e Movimento", data: [
          { id: 17, label: "Esqueleto", img: "esqueleto.png", info: "O esqueleto humano d√° suporte ao corpo e protege √≥rg√£os delicados como o c√©rebro." },
          { id: 18, label: "M√∫sculos", img: "musculo.png", info: "Existem centenas de m√∫sculos que se contraem para nos permitir correr, saltar e sorrir." },
          { id: 19, label: "Costelas", img: "costelas.png", info: "As costelas formam uma 'caixa' protetora ao redor do cora√ß√£o e dos pulm√µes." },
          { id: 20, label: "Coluna", img: "coluna.png", info: "A coluna vertebral nos mant√©m eretos e protege a medula nervosa." },
          { id: 21, label: "Cr√¢nio", img: "cranio.png", info: "O cr√¢nio √© um osso muito resistente que serve de capacete natural para o c√©rebro." },
          { id: 22, label: "Articula√ß√µes", img: "articulacoes.png", info: "As articula√ß√µes (como joelhos e cotovelos) permitem que os nossos ossos se dobrem." },
          { id: 23, label: "F√™mur", img: "femur.png", info: "O f√™mur √© o osso mais longo e forte do corpo humano, localizado na coxa." },
          { id: 24, label: "Tend√µes", img: "tendoes.png", info: "Os tend√µes ligam os m√∫sculos aos ossos, permitindo o movimento de flex√µes e extens√µes dos membros e articula√ß√µes do corpo." }
      ]}
    ];

    let currentLevelIdx = 0;
    let matches = 0;
    let flipped = [];
    let locked = false;
    let soundEnabled = true;

    function speak(text) {
      if (!soundEnabled) return;
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'pt-BR';
      utterance.rate = 1.0;
      window.speechSynthesis.speak(utterance);
    }

    window.toggleSound = function() {
      soundEnabled = !soundEnabled;
      const btn = document.getElementById('soundToggleBtn');
      if (soundEnabled) {
        btn.innerHTML = `<span id="soundIcon">üîä</span> Som: Ligado`;
        speak("Som ligado");
      } else {
        btn.innerHTML = `<span id="soundIcon">üîà</span> Som: Desligado`;
        window.speechSynthesis.cancel();
      }
    };

    window.validateRegistration = function() {
      const name = document.getElementById('userName').value.trim();
      const uClass = document.getElementById('userClass').value.trim();
      const grid = document.getElementById('menuGrid');
      const hint = document.getElementById('regHint');

      if (name.length >= 3 && uClass.length >= 1) {
        grid.classList.add('active');
        hint.style.color = "#4ade80";
        hint.innerHTML = "‚úÖ Voc√™ est√° pronto! Escolha uma fase.";
      } else {
        grid.classList.remove('active');
        hint.style.color = "#fb7185";
        hint.innerHTML = "Preenche os dados para desbloquear as miss√µes.";
      }
    };

    function enterFullscreen() {
      const el = document.documentElement;
      if (el.requestFullscreen) el.requestFullscreen();
      else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
      else if (el.msRequestFullscreen) el.msRequestFullscreen();
    }

    window.startGame = function(idx) {
      enterFullscreen();
      currentLevelIdx = idx;
      document.getElementById('menuScreen').style.display = 'none';
      document.getElementById('gameScreen').style.display = 'flex';
      speak("Iniciando a " + LEVELS[idx].title);
      resetBoard();
    };

    function resetBoard() {
      matches = 0;
      flipped = [];
      locked = false;
      document.getElementById('pairCount').textContent = '0';
      document.getElementById('currentLevelTitle').textContent = LEVELS[currentLevelIdx].title;

      const grid = document.getElementById('grid');
      grid.innerHTML = '';

      const levelData = LEVELS[currentLevelIdx].data;
      const deck = [...levelData, ...levelData].sort(() => Math.random() - 0.5);

      deck.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="inner">
            <div class="face back"></div>
            <div class="face front">
              <img class="card-photo" src="${item.img}" alt="${item.label}">
              <div class="card-label">${item.label}</div>
            </div>
          </div>`;
        card.onclick = () => handleFlip(card, item);
        grid.appendChild(card);
      });
    }

    function handleFlip(card, item) {
      if (locked || card.classList.contains('flipped') || card.classList.contains('matched')) return;

      card.classList.add('flipped');
      speak(item.label);
      flipped.push({ card, item });

      if (flipped.length === 2) {
        locked = true;

        if (flipped[0].item.id === flipped[1].item.id) {
          matches++;
          document.getElementById('pairCount').textContent = matches;
          flipped[0].card.classList.add('matched');
          flipped[1].card.classList.add('matched');

          setTimeout(() => {
            showInfo(flipped[0].item);
            flipped = [];
            locked = false;
          }, 500);
        } else {
          setTimeout(() => {
            flipped[0].card.classList.remove('flipped');
            flipped[1].card.classList.remove('flipped');
            flipped = [];
            locked = false;
          }, 1000);
        }
      }
    }

    function showInfo(item) {
      const infoImg = document.getElementById('infoImage');
      infoImg.src = item.img;
      infoImg.alt = item.label;

      document.getElementById('infoTitle').textContent = item.label;
      document.getElementById('infoText').textContent = item.info;

      document.getElementById('infoModal').classList.add('show');
      speak(item.info);
    }

    window.closeInfo = function() {
      window.speechSynthesis.cancel();
      document.getElementById('infoModal').classList.remove('show');
      if (matches === 8) showWin();
    };

    function showWin() {
      const isFinal = currentLevelIdx === 2;
      document.getElementById('winHeading').textContent = isFinal ? "PARAB√âNS, EXPLORADOR!" : "Miss√£o Cumprida!";
      document.getElementById('winMessage').textContent = isFinal
        ? "Voc√™ completou as 3 fases da Mem√≥ria do Sim√£o ‚Äì Corpo Humano com distin√ß√£o."
        : "Est√° quase l√°! Falta pouco para o certificado final.";

      document.getElementById('nextPhaseBtn').style.display = isFinal ? "none" : "block";
      document.getElementById('getCertBtn').style.display = isFinal ? "block" : "none";
      document.getElementById('winModal').classList.add('show');

      if (isFinal) speak("Parab√©ns! Voc√™ completou todas as fases da Mem√≥ria do Sim√£o. Agora voc√™ pode obter seu certificado.");
      else speak("Miss√£o cumprida! Vamos para a pr√≥xima fase?");
    }

    window.nextPhase = function() {
      currentLevelIdx++;
      document.getElementById('winModal').classList.remove('show');
      speak("Iniciando a " + LEVELS[currentLevelIdx].title);
      resetBoard();
    };

    window.showFinalCertificate = function() {
      document.getElementById('winModal').classList.remove('show');
      document.getElementById('gameScreen').style.display = 'none';
      document.getElementById('certScreen').style.display = 'flex';

      const name = document.getElementById('userName').value;
      document.getElementById('certName').textContent = name;
      document.getElementById('certDate').textContent = new Date().toLocaleDateString('pt-BR');

      speak("Aqui est√° o seu certificado, " + name + ". Bom trabalho!");
    };

    // ======= PRINT: CERTIFICADO =======
    window.printCertificate = function(){
      document.body.classList.remove("print-mode-cards");
      document.body.classList.add("print-mode-cert");
      window.print();
      setTimeout(() => document.body.classList.remove("print-mode-cert"), 300);
    };

    // ======= EXPORTA√á√ÉO PDF (CARTAS) =======
    function buildSheet(title, cardsHTML){
      return `
        <div class="sheet">
          <div class="print-title">${title}</div>
          <div class="print-grid">
            ${cardsHTML}
          </div>
        </div>
      `;
    }

    function makeFrontCards(levelIdx){
      const data = LEVELS[levelIdx].data;
      const deck = [...data, ...data]; // 16
      return deck.map(item => `
        <div class="print-card">
          <div class="print-card-front">
            <img src="${item.img}" alt="${item.label}">
            <div class="lbl">${item.label}</div>
          </div>
        </div>
      `).join("");
    }

    function makeBackCards(backImg){
      const total = 16;
      let html = "";
      for (let i = 0; i < total; i++){
        html += `
          <div class="print-card print-back">
            <img src="${backImg}" alt="Verso da carta">
          </div>
        `;
      }
      return html;
    }

    function waitImagesLoaded(container){
      const imgs = Array.from(container.querySelectorAll("img"));
      const promises = imgs.map(img => new Promise(resolve => {
        if (img.complete && img.naturalWidth > 0) return resolve(true);
        img.onload = () => resolve(true);
        img.onerror = () => resolve(false);
      }));
      return Promise.all(promises);
    }

    window.exportPDF_All = async function(){
      const printArea = document.getElementById("printArea");
      printArea.style.display = "block";

      // ativa modo CARTAS
      document.body.classList.remove("print-mode-cert");
      document.body.classList.add("print-mode-cards");

      const back1 = "capa-carta-corpo.png";
      const back2 = "capa-carta-corpo.png";
      const back3 = "capa-carta-corpo.png";

      let html = "";
      html += buildSheet("FRENTES ‚Äî Fase 1", makeFrontCards(0));
      html += buildSheet("VERSOS ‚Äî Fase 1", makeBackCards(back1));
      html += buildSheet("FRENTES ‚Äî Fase 2", makeFrontCards(1));
      html += buildSheet("VERSOS ‚Äî Fase 2", makeBackCards(back2));
      html += buildSheet("FRENTES ‚Äî Fase 3", makeFrontCards(2));
      html += buildSheet("VERSOS ‚Äî Fase 3", makeBackCards(back3));

      printArea.innerHTML = html;

      await waitImagesLoaded(printArea);
      window.print();

      setTimeout(() => {
        printArea.innerHTML = "";
        printArea.style.display = "none";
        document.body.classList.remove("print-mode-cards");
      }, 800);
    };
  </script>
</body>
</html>
